<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Settings | Post-Labor Economics</title>
  <link rel="icon" type="image/svg+xml" href="/ple-logo.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,400;9..144,500;9..144,600;9..144,700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/src/styles/app.css">
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    .settings-section{background:white;border:1px solid var(--border-color,#e5e2dd);border-radius:12px;padding:1.5rem;margin-bottom:1.25rem}
    .settings-section h3{font-family:'Fraunces',serif;font-size:1.1rem;margin-bottom:1rem}
    .setting-row{display:flex;justify-content:space-between;align-items:center;padding:0.75rem 0;border-bottom:1px solid #f5f5f5}
    .setting-row:last-child{border-bottom:none}
    .setting-info{flex:1}
    .setting-label{font-weight:600;font-size:0.9rem}
    .setting-desc{font-size:0.8rem;color:var(--text-muted);margin-top:0.15rem}
    .toggle{position:relative;width:44px;height:24px;background:#ddd;border-radius:12px;cursor:pointer;transition:background 0.2s;border:none;flex-shrink:0}
    .toggle::after{content:'';position:absolute;width:20px;height:20px;background:white;border-radius:50%;top:2px;left:2px;transition:transform 0.2s;box-shadow:0 1px 3px rgba(0,0,0,0.15)}
    .toggle.on{background:var(--color-horizon,#1B4D3E)}
    .toggle.on::after{transform:translateX(20px)}
    .danger-zone{border-color:#FEE2E2}
    .danger-zone h3{color:#DC2626}
  </style>
</head>
<body>
  <a href="#main-content" class="skip-nav">Skip to main content</a>
  <header class="nav-header">
    <nav class="nav-container">
      <a href="index.html" class="nav-logo"><span class="logo-symbol">L/0</span> <span class="logo-text">Post-Labor Economics</span></a>
      <button class="nav-toggle" aria-label="Toggle navigation" onclick="document.querySelector('.nav-menu').classList.toggle('open')"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button>
      <div class="nav-menu">
        <a href="content.html" class="nav-link">Content</a>
        <a href="projects.html" class="nav-link">Projects</a>
        <a href="proposals.html" class="nav-link">Proposals</a>
        <a href="discussions.html" class="nav-link">Discussions</a>
        <a href="tags.html" class="nav-link">Tags</a>
        <a href="search.html" class="nav-link" style="padding:0.4rem;display:flex;" title="Search"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></a>
        <a href="login.html" class="nav-link" data-auth="logged-out">Sign In</a>
        <a href="dashboard.html" class="nav-link" data-auth="logged-in" style="display:none">Dashboard</a>
      </div>
    </nav>
  </header>

  <main id="main-content" style="max-width:640px;margin:0 auto;padding:2rem 1.5rem;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem">
      <div>
        <h1 style="font-family:'Fraunces',serif;font-size:1.75rem;">Settings</h1>
        <p style="color:var(--text-muted);font-size:0.9rem;">Customize your PLE experience</p>
      </div>
      <a href="dashboard.html" class="btn btn-ghost">‚Üê Dashboard</a>
    </div>

    <div class="settings-section">
      <h3>üé® Appearance</h3>
      <div class="setting-row">
        <div class="setting-info">
          <div class="setting-label">Dark Mode</div>
          <div class="setting-desc">Use dark color scheme across the platform</div>
        </div>
        <button class="toggle" id="toggle-dark" onclick="toggleSetting('dark')" aria-label="Toggle dark mode"></button>
      </div>
    </div>

    <div class="settings-section">
      <h3>üîî Notifications</h3>
      <div class="setting-row">
        <div class="setting-info">
          <div class="setting-label">Activity Notifications</div>
          <div class="setting-desc">Show the notification bell with unread activity count</div>
        </div>
        <button class="toggle on" id="toggle-notifs" onclick="toggleSetting('notifs')" aria-label="Toggle notifications"></button>
      </div>
      <div class="setting-row">
        <div class="setting-info">
          <div class="setting-label">Sound Alerts</div>
          <div class="setting-desc">Play a sound when new notifications arrive</div>
        </div>
        <button class="toggle" id="toggle-sound" onclick="toggleSetting('sound')" aria-label="Toggle sound alerts"></button>
      </div>
    </div>

    <div class="settings-section">
      <h3>‚úèÔ∏è Editor</h3>
      <div class="setting-row">
        <div class="setting-info">
          <div class="setting-label">Auto-Save Drafts</div>
          <div class="setting-desc">Automatically save your work every 30 seconds</div>
        </div>
        <button class="toggle on" id="toggle-autosave" onclick="toggleSetting('autosave')" aria-label="Toggle auto-save"></button>
      </div>
      <div class="setting-row">
        <div class="setting-info">
          <div class="setting-label">Markdown Preview</div>
          <div class="setting-desc">Show live markdown preview while editing</div>
        </div>
        <button class="toggle on" id="toggle-preview" onclick="toggleSetting('preview')" aria-label="Toggle preview"></button>
      </div>
    </div>

    <div class="settings-section">
      <h3>üìñ Reading</h3>
      <div class="setting-row">
        <div class="setting-info">
          <div class="setting-label">Reading Progress Bar</div>
          <div class="setting-desc">Show scroll progress bar on articles</div>
        </div>
        <button class="toggle on" id="toggle-progressbar" onclick="toggleSetting('progressbar')" aria-label="Toggle progress bar"></button>
      </div>
      <div class="setting-row">
        <div class="setting-info">
          <div class="setting-label">Table of Contents</div>
          <div class="setting-desc">Auto-generate table of contents for long articles</div>
        </div>
        <button class="toggle on" id="toggle-toc" onclick="toggleSetting('toc')" aria-label="Toggle table of contents"></button>
      </div>
    </div>

    <div class="settings-section">
      <h3>üîó Account</h3>
      <div class="setting-row">
        <div class="setting-info">
          <div class="setting-label">Edit Profile</div>
          <div class="setting-desc">Update your name, bio, and avatar</div>
        </div>
        <a href="profile.html" class="btn btn-ghost" style="font-size:0.85rem">Edit ‚Üí</a>
      </div>
    </div>

    <div class="settings-section danger-zone">
      <h3>‚ö†Ô∏è Data</h3>
      <div class="setting-row">
        <div class="setting-info">
          <div class="setting-label">Clear Local Data</div>
          <div class="setting-desc">Remove saved drafts, bookmarks, and preferences from this browser</div>
        </div>
        <button class="btn btn-ghost" style="font-size:0.85rem;color:#DC2626;border-color:#FCA5A5" onclick="clearLocalData()">Clear</button>
      </div>
    </div>
  </main>

  <script type="module">
    import { initPage, auth } from './src/scripts/api.js';
    await initPage();

    const token = localStorage.getItem('ple_token');
    if (!token) window.location = '/login.html?redirect=/settings';

    // Load saved settings
    const settings = JSON.parse(localStorage.getItem('ple_settings') || '{}');
    const defaults = { dark: false, notifs: true, sound: false, autosave: true, preview: true, progressbar: true, toc: true };

    Object.keys(defaults).forEach(key => {
      const val = settings[key] !== undefined ? settings[key] : defaults[key];
      const toggle = document.getElementById('toggle-' + key);
      if (toggle) toggle.classList.toggle('on', val);
    });

    // Sync dark mode with existing toggle
    const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
    document.getElementById('toggle-dark')?.classList.toggle('on', isDark);

    window.toggleSetting = function(key) {
      const toggle = document.getElementById('toggle-' + key);
      const isOn = toggle.classList.toggle('on');
      settings[key] = isOn;
      localStorage.setItem('ple_settings', JSON.stringify(settings));

      // Apply immediately
      if (key === 'dark') {
        document.documentElement.setAttribute('data-theme', isOn ? 'dark' : '');
        localStorage.setItem('ple_theme', isOn ? 'dark' : '');
        const darkBtn = document.querySelector('.dark-toggle');
        if (darkBtn) darkBtn.textContent = isOn ? '‚òÄÔ∏è' : 'üåô';
      }
    };

    window.clearLocalData = function() {
      if (!confirm('This will remove all locally saved drafts, bookmarks, and preferences. Continue?')) return;
      const keysToRemove = [];
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith('ple_') && key !== 'ple_token') keysToRemove.push(key);
      }
      keysToRemove.forEach(k => localStorage.removeItem(k));
      location.reload();
    };
  </script>
<footer style="margin-top:4rem;padding:1.5rem 0;border-top:1px solid var(--border-color,#e5e2dd);text-align:center;font-size:0.8rem;color:var(--text-muted,#888);"><div style="max-width:1200px;margin:0 auto;padding:0 1.5rem;"><a href="index.html" style="text-decoration:none;color:inherit;font-weight:600;">L/0</a> Post-Labor Economics ¬∑ <a href="about.html" style="color:inherit;">About</a> ¬∑ <a href="community.html" style="color:inherit;">Community</a> ¬∑ <a href="/api/rss" style="color:inherit;">RSS</a></div></footer>
<script src="/chat-widget.js" defer></script>
</body>
</html>
