<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Post-Labor Economics | Prosperity Beyond Work</title>
  <meta name="description" content="Building the intellectual and policy frameworks for a world where human dignity and economic security are no longer dependent on selling your time.">
  
  <link rel="icon" type="image/svg+xml" href="ple-logo.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,400;9..144,500;9..144,600;9..144,700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="src/styles/brand.css">
  <link rel="stylesheet" href="src/styles/app.css">
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-container">
      <a href="index.html" class="logo">
        <span class="logo-symbol">L/0</span>
        <span class="logo-text">Post-Labor Economics</span>
      </a>
      
      <button class="nav-toggle" onclick="document.querySelector('.nav-menu').classList.toggle('open')" aria-label="Menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button>
      <nav class="nav-menu">
        <a href="projects.html" class="nav-link">Projects</a>
        <a href="content.html" class="nav-link">Content</a>
        <a href="proposals.html" class="nav-link">Proposals</a>
        <a href="discussions.html" class="nav-link">Discussions</a>
        <a href="architecture.html" class="nav-link">Architecture</a>
      </nav>
      
      <div class="header-actions">
        <a href="search.html" class="nav-link" style="padding:0.4rem;display:flex;" title="Search"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></a>
        <a href="login.html" class="btn btn-ghost" data-auth="logged-out">Sign In</a>
        <a href="register.html" class="btn btn-primary" data-auth="logged-out">Join Us</a>
        <a href="dashboard.html" class="btn btn-primary" data-auth="logged-in" style="display:none">Dashboard</a>
      </div>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="hero">
    <div class="container">
      <div class="hero-content">
        <p class="hero-eyebrow">The Movement for Economic Liberation</p>
        <h1 class="hero-title">Prosperity Beyond Work</h1>
        <p class="hero-description">
          We're not preparing for job lossâ€”we're preparing for liberation. Building frameworks 
          for a world where human dignity and economic security exist independent of labor markets.
        </p>
        <div class="hero-actions">
          <a href="register.html" class="btn btn-primary btn-lg" data-auth="logged-out">
            Join the Movement
            <i data-lucide="arrow-right"></i>
          </a>
          <a href="dashboard.html" class="btn btn-primary btn-lg" data-auth="logged-in" style="display:none">
            Go to Dashboard
            <i data-lucide="arrow-right"></i>
          </a>
          <a href="about.html" class="btn btn-outline btn-lg">
            Learn More
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Live Stats Section -->
  <section class="section">
    <div class="container">
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-value" id="content-count">-</div>
          <div class="stat-label">Published Articles</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="projects-count">-</div>
          <div class="stat-label">Active Projects</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="proposals-count">-</div>
          <div class="stat-label">Community Proposals</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="elements-count">-</div>
          <div class="stat-label">Discussions</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Latest Content -->
  <section class="section section-muted">
    <div class="container">
      <div class="section-header">
        <h2 class="section-title">Latest from the Community</h2>
        <p class="section-description">
          Research, analysis, and policy frameworks from contributors building the post-labor future.
        </p>
      </div>
      <div id="latest-content">
        <div class="loading"><div class="loading-spinner"></div></div>
      </div>
      <div class="section-footer" style="display:flex;gap:1rem;justify-content:center;flex-wrap:wrap;">
        <a href="content.html" class="btn btn-outline">Browse All Content <i data-lucide="arrow-right"></i></a>
        <a href="projects.html" class="btn btn-outline">View Projects <i data-lucide="arrow-right"></i></a>
      </div>
    </div>
  </section>

  <!-- Community Activity -->
  <section class="section">
    <div class="container">
      <div class="section-header">
        <h2 class="section-title">Community Pulse</h2>
        <p class="section-description">Active proposals, discussions, and platform activity.</p>
      </div>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:2rem;">
        <!-- Recent Proposals -->
        <div>
          <h3 class="subsection-title">Recent Proposals</h3>
          <div id="recent-proposals">
            <div class="loading"><div class="loading-spinner"></div></div>
          </div>
          <div class="subsection-footer">
            <a href="proposals.html" class="btn btn-ghost btn-sm">View All Proposals</a>
          </div>
        </div>
        
        <!-- Active Discussions -->
        <div>
          <h3 class="subsection-title">Active Discussions</h3>
          <div id="recent-discussions">
            <div class="loading"><div class="loading-spinner"></div></div>
          </div>
          <div class="subsection-footer">
            <a href="discussions.html" class="btn btn-ghost btn-sm">View All Discussions</a>
          </div>
        </div>
        
        <!-- Activity Feed -->
        <div>
          <h3 class="subsection-title">Platform Activity</h3>
          <div class="activity-feed" id="activity-feed">
            <div class="activity-feed-header">Latest Updates</div>
            <div class="loading"><div class="loading-spinner"></div></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <style>
    @media(max-width:900px) { [style*="grid-template-columns:repeat(3"] { grid-template-columns:1fr !important; } }
  </style>

  <!-- CTA Section -->
  <section class="section section-primary">
    <div class="container">
      <div class="cta-content">
        <h2 class="cta-title">Ready to Shape the Future?</h2>
        <p class="cta-description">
          Join a growing community of thinkers, researchers, and advocates working toward 
          economic systems that serve human flourishing.
        </p>
        <div class="cta-actions">
          <a href="register.html" class="btn btn-light btn-lg" data-auth="logged-out">
            Create Your Account
          </a>
          <a href="content-editor.html" class="btn btn-light btn-lg" data-auth="logged-in" style="display:none">
            Write Something
          </a>
          <a href="proposals.html" class="btn btn-outline-light btn-lg">
            Browse Proposals
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-grid">
        <div class="footer-brand">
          <div class="logo">
            <span class="logo-symbol">L/0</span>
            <span class="logo-text">Post-Labor Economics</span>
          </div>
          <p class="footer-tagline">Prosperity Beyond Work</p>
        </div>
        
        <div class="footer-links">
          <h4>Platform</h4>
          <a href="projects.html">Projects</a>
          <a href="content.html">Content</a>
          <a href="proposals.html">Proposals</a>
          <a href="discussions.html">Discussions</a>
          <a href="architecture.html">Architecture</a>
        </div>
        
        <div class="footer-links">
          <h4>Resources</h4>
          <a href="about.html">About</a>
          <a href="gato.html">GATO Framework</a>
          <a href="prime.html">THE PRIME</a>
        </div>
        
        <div class="footer-links">
          <h4>Community</h4>
          <a href="https://discord.gg/postlabor" target="_blank">Discord</a>
          <a href="https://github.com/daveshap" target="_blank">GitHub</a>
        </div>
      </div>
      
      <div class="footer-bottom">
        <p>&copy; 2025 Post-Labor Economics. Open source and community-driven.</p>
      </div>
    </div>
  </footer>

  <script type="module">
    import { proposals, activity, formatDate, initPage } from './src/scripts/api.js';
    
    // Load live stats
    async function loadStats() {
      try {
        const [cR, pR, prR, dR] = await Promise.allSettled([
          fetch('/api/content?limit=1&status=published').then(r=>r.json()),
          fetch('/api/projects?limit=1').then(r=>r.json()),
          proposals.list({limit:1}),
          fetch('/api/discussions?limit=1').then(r=>r.json())
        ]);
        if(cR.status==='fulfilled') document.getElementById('content-count').textContent = cR.value.total||0;
        if(pR.status==='fulfilled') document.getElementById('projects-count').textContent = pR.value.total||0;
        if(prR.status==='fulfilled') document.getElementById('proposals-count').textContent = prR.value.total||0;
        if(dR.status==='fulfilled') document.getElementById('elements-count').textContent = dR.value.total||0;
      } catch(e) { console.error('Stats:', e); }
    }

    // Load latest content
    async function loadContent() {
      try {
        const data = await fetch('/api/content?limit=4&status=published').then(r=>r.json());
        const el = document.getElementById('latest-content');
        if (!data.content?.length) { el.innerHTML = '<p style="text-align:center;color:var(--text-muted)">Content coming soon.</p>'; return; }
        el.innerHTML = `<div class="element-grid">${data.content.map(c => {
          const tags = (c.tags||[]).slice(0,2).map(t=>`<span style="font-size:0.65rem;padding:0.1rem 0.4rem;border-radius:100px;background:rgba(27,77,62,0.08);color:var(--color-horizon,#1B4D3E)">${c.tags ? t : ''}</span>`).join(' ');
          const words=(c.body||'').split(/\s+/).length;
          const readTime=Math.max(1,Math.ceil(words/200));
          return `
          <a href="content-view.html?id=${c.slug||c.id}" class="element-card" style="text-decoration:none;color:inherit;cursor:pointer;transition:box-shadow 0.2s;">
            <div class="element-card-header" style="display:flex;justify-content:space-between;align-items:center;">
              <span class="element-code goal" style="font-size:0.7rem">${(c.contentType||'article').replace('_',' ').toUpperCase()}</span>
              <span style="font-size:0.7rem;color:var(--text-muted,#888)">${readTime} min read</span>
            </div>
            <h4 class="element-title">${c.title}</h4>
            <p class="element-description">${c.excerpt||(c.body||'').substring(0,120)+'...'}</p>
            ${tags ? `<div style="margin-top:0.5rem">${tags}</div>` : ''}
          </a>`;
        }).join('')}</div>`;
      } catch(e) { document.getElementById('latest-content').innerHTML=''; }
    }

    // Load recent discussions
    async function loadDiscussions() {
      try {
        const data = await fetch('/api/discussions?limit=3').then(r=>r.json());
        const el = document.getElementById('recent-discussions');
        if (!data.discussions?.length) { el.innerHTML='<p style="color:var(--text-muted)">No discussions yet.</p>'; return; }
        el.innerHTML = data.discussions.map(d => `
          <a href="discussion-view.html?id=${d.id}" style="display:block;padding:0.75rem 0;border-bottom:1px solid var(--color-gray-50,#eee);text-decoration:none;color:inherit;">
            <div style="font-weight:600;font-size:0.9rem;margin-bottom:0.25rem;">${d.title||'Untitled'}</div>
            <div style="font-size:0.8rem;color:var(--text-muted,#888);display:flex;gap:0.75rem;">
              <span>${d.author?.name||'Anonymous'}</span>
              <span>${d.replyCount||0} replies</span>
            </div>
          </a>
        `).join('');
      } catch(e) { document.getElementById('recent-discussions').innerHTML=''; }
    }
    
    // Load recent proposals
    async function loadProposals() {
      try {
        const data = await proposals.list({ limit: 3 });
        const container = document.getElementById('recent-proposals');
        
        if (data.proposals.length === 0) {
          container.innerHTML = '<div class="empty-state"><p>No proposals yet. Be the first!</p><a href="proposal-create.html" class="btn btn-primary">Create Proposal</a></div>';
          lucide.createIcons(); return;
        }
        
        container.innerHTML = data.proposals.map(p => `
          <div class="proposal-card">
            <div class="proposal-card-header">
              <span class="proposal-type-badge ${p.proposalType}">${p.proposalType.replace('_', ' ')}</span>
            </div>
            <h4 class="proposal-title"><a href="proposal-view.html?id=${p.id}">${p.title}</a></h4>
            <p class="proposal-excerpt">${p.content.substring(0, 150)}${p.content.length > 150 ? '...' : ''}</p>
            <div class="proposal-meta">
              <span class="proposal-meta-item"><i data-lucide="user"></i>${p.author?.name || 'Anonymous'}</span>
              <span class="proposal-meta-item"><i data-lucide="clock"></i>${formatDate(p.createdAt)}</span>
            </div>
          </div>
        `).join('');
        lucide.createIcons();
      } catch (e) {
        document.getElementById('recent-proposals').innerHTML = '<p style="color:var(--text-muted)">Unable to load proposals.</p>';
      }
    }
    
    // Load activity feed
    async function loadActivity() {
      try {
        const data = await activity.list({ limit: 5 });
        const container = document.getElementById('activity-feed');
        
        if (data.activities.length === 0) {
          container.innerHTML = '<div class="activity-feed-header">Latest Updates</div><p style="color:var(--text-muted);padding:1rem 0">Activity will appear as the community grows.</p>';
          return;
        }
        
        container.innerHTML = `<div class="activity-feed-header">Latest Updates</div>${data.activities.map(a => `
          <div class="activity-item"><div class="activity-icon"><i data-lucide="${getIcon(a.action)}"></i></div><div class="activity-content"><div class="activity-description">${a.description}</div><div class="activity-time">${formatDate(a.createdAt)}</div></div></div>
        `).join('')}`;
        lucide.createIcons();
      } catch (e) {
        document.getElementById('activity-feed').innerHTML = '<div class="activity-feed-header">Latest Updates</div>';
      }
    }
    
    function getIcon(a) {
      return {'user_registered':'user-plus','proposal_created':'file-plus','vote_cast':'vote','discussion_created':'message-square','reply_created':'reply'}[a]||'activity';
    }
    
    await initPage();
    loadStats();
    loadContent();
    loadProposals();
    loadDiscussions();
    loadActivity();
    lucide.createIcons();
  </script>
</body>
</html>
